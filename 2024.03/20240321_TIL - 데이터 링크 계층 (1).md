# 20240321_TIL - 데이터 링크 계층 (1)

## Data Link Layer

- 어플리케이션 계층: `메시지`, 소켓 - 소켓 사이 통신
- 전송 계층: `세그먼트`, 신뢰성 있는 데이터 전송
- 네트워크 계층: `패킷`, 어떤 경로로 전송하는지(라우팅)
- 데이터 링크 계층: `프레임`, 다음 게이트웨이까지 가는 방법

### Cocktail Party

패킷을 생성하면 제일 먼저 게이트웨이 라우터로 전송한다. 이 경로는 공용이므로 충돌이 발생할 수도 있다. 또한 혼잡도가 올라가서 전송에 혼선이 생길 수 있다. 이를 `칵테일 파티 효과`라고 한다.

데이터 링크 계층은 이런 충돌이 발생하지 않게 예방하고 발생할 때 해결하는 역할을 맡는다. 

- `sender`
    - IP 데이터그램을 프레임에 캡슐화
    - 이상감지를 위한 에러검출비트 추가
    - rdt
    - flow control 등
- `receiver`
    - 위의 것들이 잘 들어왔는지 확인
    - 데이터그램 추출, 상위 계층으로 전달

### 구현 위치

전송 계층과 네트워크 계층 등 상위 계층은 OS 내부에 코드로 존재하지만, 데이터 링크 계층부터는 NIC 안에 하드웨어로 구현되어 있다. 

네트워크 계층에서 내려온 IP 데이터그램은 NIC로 전달된다. 그리고 NIC에서 전송 단위인 `프레임`의 데이터로 포함되어 외부로 전송된다.

### 링크의 유형

- `point-to-point`
    
    호스트 사이의 전용선이다. 아무런 데이터 충돌도 일어날 수 없다. 
    
- `broadcast`
    
    많은 사람들이 공유하는 채널을 가진 공용 링크다. 대부분의 데이터링크가 해당된다. 
    
    한 곳에서 시그널을 보내면 공유 채널 전체에 퍼지는데, 이를 퍼트리는 매체를 `broadcast medium`, 말 그대로 방송매체 라고 한다.
    
    매체를 통해 퍼트리는 과정에서 데이터 간 충돌 등이 발생할 수 있으므로, 데이터 링크 계층에서는 조절을 통해 충돌을 해결하는 프로토콜을 제공한다. 
    
    이를 `Media Access Control`이라고 하고 줄여서 `MAC 프로토콜`이라고 한다.
    

## MAC 프로토콜

### 이상편

1. 하나의 노드가 데이터를 전송하려면 브로드캐스트 채널의 대역폭을 전부 사용할 있어야 한다.
2. 여러 개의 노드가 데이터를 전송하려면 각 노드는 브로드캐스트 채널의 대역폭을 정확히 1/N해서 사용해야 한다.
3. 중앙 컨트롤러 없이 분산처리 되어서 알아서 잘 동작해야 한다.
4. 단순해야 한다.

### 현실편 - Channel Partitioning

채널을 노드별로 사용할 수 있게 하는 고유 영역으로 나눠서 독점 할당하는 방식이다.

- `TDMA(Time Division Multiple Access) Protocol`
    
    시간을 쪼개서 여러 사람이 정해진 타임 슬롯에 이용하게 한다. 이 경우 사용되지 않는 타임 슬롯은 낭비된다는 단점이 있다.
    
- `FDMA(Frequency Division Multiple Access) Protocol`
    
    시간이 아니라 주파수를 쪼개서 배정한다. 쪼개는 기준은 전체 채널 대역폭을 사용자 수로 나눈 만큼의 값이다.
    
    마찬가지로 전체 대역폭에서 사용되지 않는 주파수는 낭비된다는 단점이 있다.
    

### 현실편 - Random Access

위의 두 방법과 다르게 보내는 방식에 제한이 없다. 노드별로 전송하려는 패킷을 가지고 있으면 전체 채널 대역폭으로 전송 가능하다.

충돌이 필연적으로 발생할 수 밖에 없다. 이를 위해서 충돌 감지와 복구 방법이 있어야 한다.

- `CSMA(Carrier Sense Multiple Access) Protocol`
    
    데이터를 전송하기 이전에 방송 매체를 사용하는 노드가 있는지 확인한다. 즉 전송 이전에 누가 말하고 있는지 듣고 있다.
    
    채널이 사용되지 않는 idle 상태일 때까지 기다렸다가 프레임을 전송한다.
    
    그러나 이전에 매체를 사용한 노드의 전송 프레임이 전파 지연으로 뒤늦게 도착하는 경우엔 충돌이 생길 수도 있다. 전파 지연은 빛의 속도로 전송되는 것이 곧 ‘즉시’는 아니기 때문에 불가피하다.
    
- `CSMA/CD(Collision Detection) Protocol`
    
    충돌은 피할 수 없으니, 충돌이 일어나면 이걸 보고 잠시 피하는 방식이다. 다른 부분은 CSMA 프로토콜과 동일하다.
    
    프레임이 목적지에 도착하기 전에 다른 프레임이 아직 전송되고 있음을 감지하면 충돌이 일어났다고 간주하고 전송을 중단하고 jam 신호를 보낸다.
    
    - `binary back-off`
        
        충돌이 m번 감지되면, 0 ~ 2^(m-1) 중의 숫자에서 임의의 숫자를 선택하고, 거기에 512bit 만큼의 시간을 곱해 기다리고 다시 재전송한다.
        
    
    따라서 충돌이 길어질 수록 대기시간이 길어진다는 단점이 있다.
    

### 현실편 - Taking Turns

노드들이 턴제로 데이터를 전송한다. 턴을 결정하는 방식을 두고 전송과 충돌을 중재하게 한다. 사실 다른 노드를 컨트롤하는 매체가 존재한다는 점에서 잘 사용하지 않는 방식이다(이상편의 3번 위반).

- `Polling`
    
    마스터 노드가 노예 노드에 방문해 전송하게 한다. 마스터가 고장나면 모든 전송이 멈춘다는 치명적인 단점이 있다.
    
- `Token Passing`
    
    `토큰`이라는 특별한 메시지를 갖고 있는 호스트만 데이터를 넘겨받게 한다. 만약 자기가 갖고 있는데 보낼 데이터가 없으면 다른 노드로 넘긴다.
    
    이 역시 `토큰`이 유실되면 전체 네트워크가 멈춘다는 치명적인 단점이 있다.