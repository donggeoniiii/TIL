# 20230323_TIL  - 데이터 링크 계층 (3)

## Recap: 다른 LAN으로의 라우팅

1. 이때 전송자 측을 `S`, 수신자 측을 `D`, 게이트웨이 라우터를 `G`라고 하자.
2. `S`가 전송하려는 IP 데이터그램을 프레임에 넣는다. 근데 `D`의 MAC 주소를 모른다.
    
    ```java
    ======== Frame Header ========
    MAC src: (A의 NIC MAC 주소)
    MAC dest: ????
    
    ------ IP Datagram Header ------
    src address: 111.111.111.111
    dest address: 222.222.222.222
    ```
    
3. 일단은 모르지만 전송받는 게이트웨이 라우터 `G`의 링크 주소를 DEST로 설정해 전송한다.
    
    ```java
    ======== Frame Header ========
    MAC src: (A의 NIC MAC 주소)
    MAC dest: (G의 외부 링크)
    
    ------ IP Datagram Header ------
    src address: 111.111.111.111
    dest address: 222.222.222.222
    ```
    
4. `G`가 프레임을 수신하면 일단 IP 계층으로 데이터그램을 보낸다. 그리고 데이터그램의 헤더에서 원래 목적지가 어디인지 알아낸다.
    
    ```java
    ------ IP Datagram Header ------
    src address: 111.111.111.111
    dest address: 222.222.222.222
    ```
    
5. 라우터가 프레임에 데이터그램을 다시 넣는다. 이번엔 진짜 목적지의 MAC 주소를 향해 목적지를 포워딩한다. 참고로 만든 사람이 라우터이므로 SRC MAC 주소도 게이트웨이 라우터의 주소다.
    
    ```java
    ======== Frame Header ========
    MAC src: (G의 내부 링크)
    MAC dest: (A의 NIC MAC 주소)
    
    ------ IP Datagram Header ------
    src address: 111.111.111.111
    dest address: 222.222.222.222
    ```
    
6. IP 데이터그램이 목적지에 잘 도착했다.

## 스위치

star 형태의 이더넷에서 중앙에 연결을 도와주는 기기다. 호스트의 컴퓨터는 모르는 존재다.

과거의 이더넷은 bus 형태로 호스트가 추가되면 직접 버스에 선을 연결해야 했다. 그러나 star 형태로 넘어오면서 중앙의 switch가 연결을 도와주기 때문에 포트에 선만 꽂으면 된다.

- 스위치 안에는 스위치 테이블이 존재한다. 테이블에는 호스트별 MAC 주소(정확히는 MAC 주소를 가진 호스트의 인터페이스)와 포트 번호가 써있다.
- 스위치는 이 테이블을 스스로 학습하며(!) 생성한다. 스위치 내부에 프레임이 들어오면, 프레임이 들어온 링크 번호와 프레임에 적힌 SRC MAC 주소를 테이블에 기록해서 다음에 올 데이터의 경로를 찾는데 쓴다.
- 만약 테이블에서 어떤 인터페이스의 목적지 정보를 못 찾으면 모든 호스트들에게 정보를 보낸다(`flooding`). 해당하는 호스트는 정보를 보고 자신의 포트 넘버를 응답으로 알려준다.
- 해당 기록은 영구적이지 않고, 시간이 지나면 사라진다.

### 라우터와 스위치의 차이점

- 공통점
    - 각자의 링크를 통해 목적지의 인터페이스 위치를 체크한다.
    - 둘 다 `포워딩 테이블`을 가지고 있다.
- 차이점
    - 라우팅은 `서로 다른 네트워크 간`에 `IP 주소`를 기반으로 목적지를 찾는다. 
    스위칭은 `동일 네트워크 안`에서 `MAC 주소`를 기반으로 통신한다 (IP가 필요 없다).
    - 라우터는 `네트워크 계층`에서 `IP 데이터그램`의 헤더를, 
    스위치는 `데이터 링크 계층`에서 `프레임`의 헤더를 까보고 목적지를 찾는다.
    - 라우터는 `라우팅 알고리즘`을 통해 만든 `테이블 기반`으로 목적지를 확인한다.
    스위치는 `들어온 데이터 기반`의 `self-learning과 flooding`으로 목적지를 확인한다.