# 20240327_TIL - 멀티미디어 네트워크

## 멀티미디어

### 음성

아날로그 데이터인 목소리를 정형화된 디지털 데이터로 바꾸기 위한 노력이 필요하다. 그 과정이 `샘플링(sampling)`이다. 

- 쉽게 얘기해서 연속적인 사람의 목소리를 주기적으로 음을 기록하는 것이다.
- 샘플링 주기가 짧을 수록 원음과의 오차가 적어진다.
- 우리가 mp3 음질을 얘기할 때 96, 128, 160kbps 등의 숫자들이 샘플링 주기를 바탕으로 한 인코딩 방식이다.

### 비디오

순간 순간의 캡쳐본인 `프레임`을 연속적으로 재생시키면 영상처럼 보인다. 여기서도 역시 연속적인 데이터인 색상을 얼마나 자세하게 표현하느냐에 따라 화질이 결정된다.

## 스트리밍 서비스

파일을 다운로드하지 않고도 미디어를 재생할 수 있게 해준다. 서버가 요청을 보내는 클라이언트에게 파일의 데이터를 보내준다고 생각하면 된다. 클라이언트 측에서 연속적인 재생을 위해서는 미디어의 재생을 위한 파일량을 넘어서는 전송 속도가 필요하다.

근데 데이터를 전송하다보면 네트워크 사정이라는 것이 지연을 야기할 수 밖에 없다. 그래서 클라이언트 측은 재생에 어느정도 필요한 데이터가 모여도 자체적인 딜레이를 생성한다. 우리가 잘 아는 `버퍼링`이다. 

클라이언트는 버퍼에 아직 재생되지 않은 미디어 데이터를 미리 모아놓고 있는데, 만약 전송 속도보다 송출 속도가 더 빠르게 되면 버퍼가 텅 비어 `버퍼링`이 발생한다.

### 전송 방식

우리가 사용하는 넷플릭스나 유튜브 등의 스트리밍 서비스는 어플리케이션 계층에 속하므로 전송계층에 의존한다. 우리가 아는 TCP와 UDP 중 하나를 사용한다는 의미다. 

### DASH (Dynamic Adaptive Streaming over HTTP)

큰 미디어 파일을 작은 chunk로 나누고, 각각의 chunk를 다양한 전송 속도로 인코딩해놓은 url과 함께 테이블로 만든다. 이를 `매니페스트 파일(mainfest file)`이라고 한다. 

스트리밍 서비스 회사 측은 클라이언트가 영상 재생을 요청하면 영상 파일을 보내는 대신에 이 `매니페스트 파일`을 보낸다. 그럼 단위 시간별로 네트워크 상황에 맞춰서 현재 가장 적합한 인코딩을 가진 chunk를 요청한다. 

### 스트리밍 서비스가 엄청난 트래픽을 감당하는 방법

유튜브는 전 세계 수십억명이 사용하는 서비스이다. 그럼 이 트래픽이 캘리포니아 어딘가의 유튜브 서버에 몰릴텐데, 이를 어떻게 처리할까?

1. 컨텐츠가 저장된 스토리지 자체를 전 세계 곳곳에 둔다. 
2. 사용자가 서비스를 요청하면 서버는 매니페스트 파일만 보낸다.
3. 매니페스트 파일의 url을 클릭하면 사용자 지역에서 가까운 스토리지로부터 해당하는 chunk를 공급받는다.

이렇게 컨텐츠가 저장된 스토리지를 전 세계 여러 서버에서 보관해주는 것을 `CDN(Content Delivery Network)`이라고 한다.

ex) cdn.domain.com/filename

1. 클라이언트가 매니페스트 파일에 있는 해당 url에 접근한다.
2. CDN 내의 DNS 서버가 요청을 한 클라이언트의 주소에 따라 가까운 지역의 CDN 스토리지로 연결해준다.
3. 해당 스토리지에서 사용자가 원하는 filename의 chunk들이 이동한다.

또한 CDN은 캐싱을 통해 해당 사용자 또는 해당 위치 근처의 다른 사용자가 다시 접속하면, 이전 기록을 토대로 본사 근처에 있는 오리진 서버가 아닌 캐시 서버에서 처리하게 도와준다.