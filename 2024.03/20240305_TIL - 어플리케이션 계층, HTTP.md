# 20240305_TIL - 컴퓨터 네트워크 기본 (2)

## Recap

- 인터넷에서 제공하는 전송 서비스에는 TCP와 UDP의 2가지가 있다.
    - TCP: 신뢰성 있음
    - UDP: 빠름
- 현재 인터넷은 패킷 기반의 전송 방식을 사용한다. (패킷 스위칭)
    - 사용자가 보내는 데이터가 패킷이라는 한 묶음 단위로 이동
    - 라우터가 패킷에 있는 목적지 정보를 보고 네트워크 라우팅을 통해 패킷의 이동 경로를 조정한다.
- 패킷 스위칭 과정에서 지연이 발생한다.
    - 처리 지연
        - 패킷 내 비트들이 유효한지 체크하면서 지연
        - 라우팅을 위해 목적지 체크하면서 지연
    - 큐잉 지연
        - 라우터의 혼잡도가 높은 경우 버퍼 혹은 큐에서 대기시간 있음
    - 전송 지연
        - 한 패킷의 첫 비트부터 마지막 비트까지 한 라우터에서 전송되는 데(== 손을 떠나는 데) 걸리는 시간
    - 전파 지연
        - 마지막 비트가 출발해서 도착하기까지 걸리는 시간

## TCP/IP 5계층 - 어플리케이션 계층

### TCP/IP 5계층

가장 상단부터 어플리케이션 - 전송 - 네트워크 - 링크 - 물리 계층에 해당한다. 각 계층에는 다양한 통신규약, 즉 프로토콜들이 존재한다.

- 어플리케이션 계층 - HTTP
- 전송 계층 - TCP/UDP
- 네트워크 계층 - IP
- 링크 계층 - WIFI, LTE, 유선 이더넷 등
- 물리 계층은 모름

### 어플리케이션의 종류

네트워크 기능이 있는 프로세스들을 생각하면 된다. 단지 그 통신하는 프로세스가 한 운영체제 안에 있는게 아니라 다른 컴퓨터에 있을 뿐이다.

- ex) 이메일, 온라인 기능이 있는 게임, 스트리밍 서비스 등등..

참고로 여기서의 네트워크 통신은 하위 계층과 통신이 아니라 다른 어플리케이션과의 통신을 말한다. 네트워크 엣지에 속하는 서버 / 클라이언트 사이에서 통신이 일어난다.

### 서버 / 클라이언트 구조

`서버`는 다른 클라이언트가 자신에게 요청을 보내야 하므로 항상 켜져 있고(always-on) IP 주소가 고정인 호스트이다. 

`클라이언트`는 서버와 필요할 때만 통신한다. 동적인 IP 주소를 가진다. 그리고 서로 다른 클라이언트 간에 직접적으로 통신하지 않는다.

cf) `peer-to-peer(P2P) 모델`

각 호스트가 서로 직접 통신하는 개념. 이 때는 두 호스트가 각각 클라이언트가 될 수도 있고 서버가 될 수도 있다. 다만 두 호스트가 둘 다 클라이언트인 경우는 없다.

### 어플리케이션 계층에서의 프로세스 통신

원래 프로세스 간의 통신은 한 컴퓨터 안에서 운영체제가 커널을 이용한 시스템 호출을 통해 처리하지만, 어플리케이션 계층은 서로 다른 컴퓨터(호스트) 상의 프로세스가 상호 통신하는 개념이다. 이 방식의 통신은 원활한 의사소통을 위해 통신을 시작하고, 기다리는 과정이 필요하다. 

서버 / 클라이언트 구조에서 클라이언트가 서버에게 요청을 보내고 서버가 요청을 기다리듯이, 여기서 통신을 시작하는 프로세스는 `클라이언트 프로세스`, 통신이 오기를 기다리는 프로세스는 `서버 프로세스`에 해당한다.

### 소켓

서로 다른 호스트 간의 프로세스 통신은 소켓을 통해 메시지를 주고 받는다. 기존에 운영체제가 사용하는 인터페이스인 커널의 개념이라고 생각하면 되겠다.

커널을 통해 메시지를 보내려면 두 호스트가 서로를 식별할 수단이 필요하다. 여기서 `IP 주소`와 `PORT 번호`가 필요하다.

- `IP 주소`
    
    인터넷 상에 존재하는 컴퓨터를 지칭하는 주소다.
    
- `PORT 번호`
    
    컴퓨터 안의 특정 프로세스를 지칭하는 주소다.
    

근데 우리가 평소에 이 두 주소를 사용해서 웹사이트에 접속하지는 않는다. 그건 흔히 url이라고 알고 있는 주소가 대신 해결해준다. 이렇게 주소가 입력되면 DNS에서 이를 판독해서 우리가 원하는 사이트로 접속시켜준다.

### 데이터 전송 서비스

네트워크 계층 구조에서 모든 하위 계층은 그 상위 계층에게 자신의 서비스를 제공한다. 그래서 어플리케이션 계층은 데이터 전송 시 신뢰할 수 있는 통신을 위해 하위의 전송 계층에서 다음과 같은 서비스를 제공받으려고 한다.

- 데이터 무결성
    
    데이터가 유실되지 않고 100% 온전하게 전송될 필요가 있다.
    
- Timing
    
    데이터가 정해진 시간 안에 도착해야 한다. 즉 딜레이가 최대한 낮아야 한다.
    
- Throughput
    
    주고 받는 데이터는 최소한의 용량을 가져야 한다. 이는 효율적인 속도를 가진 통신으로 이어진다. 
    
- 안정성
    
    주고 받는 데이터는 보안을 갖춰야 한다.
    

그런데 사실 전송 계층에서 제공하는 서비스는 TCP를 이용할 때 데이터 무결성 뿐이다. 

## HTTP

Hypertext Transfer Protocol. 하이퍼 텍스트란 중간에 링크가 포함되어있는 텍스트를 의미한다. 웹의 어플리케이션 계층에서 동작하는 프로토콜로 우리가 흔히 아는 서버 / 클라이언트에서 사용한다.

요청과 응답을 주고 받는 형태로, 서버는 요청에 대한 응답으로 클라이언트에게 객체를 전송한다.

HTTP는 위에서 말했던 전송계층의 TCP 서비스를 이용하고, 통신은 지속적인 연결 형태가 아니라 한번의 요청 - 응답 후 종료된다(Connectionless).

### HTTP의 무상태성(Stateless)

서버는 요청이 들어오면 이에 대한 응답에만 집중한다. 이전의 클라이언트 정보를 저장하지 않는다. 만약 클라이언트가 같은 응답을 원한다 하더라도 다시 서버에 연결하고 같은 요청을 보내는 과정을 거쳐야 한다.

HTTP는 무상태성을 가지고 있기 때문에 서버가 부담이 적다. 이전 기록을 보관할 필요도 없을 뿐더러 이번 요청에만 집중할 수 있는 환경이 보장된다. 

### 웹과 HTTP

웹 페이지는 여러 개의 객체로 이루어져 있다(html, jpeg, mp3 등). 기본적으로 html 파일이 있고, 그 파일이 다른 객체들을 참조하는 형태다. 이 안에 들어가려면 경로 구조로 `/`를 통해 타고 들어가는 형태다.

ex) `https://www.github.com/donggeoniiii`는 깃허브라는 호스트가 내 페이지를 경로로 타고 들어가 참조하는 형태다.

### HTTP의 통신 방식

- Persistent HTTP
    
    한번의 통신 후 연결을 끊지 않는다. 한 번 서버와 연결되면 한 연결에 다수의 객체를 주고 받을 수 있고 요청에 대한 빠른 응답이 가능하다.
    
- Non-persistent HTTP
    
    최대 한 개의 객체만 전송 가능하고, 전송이 끝나면 연결이 종료된다. 다수의 객체를 주고 받으려면 그 객체의 수만큼 TCP 연결이 필요하다.
    

### RTT(Round Trip Time)과 HTTP 응답 시간

패킷이 클라이언트에서 서버로 이동 하고 다시 도착하기까지 걸리는 시간. TCP의 핸드셰이크와 실제 요청 - 응답이 종료되기까지 총 2번 발생한다.

즉 HTTP 응답 시간은 `2RTT + 파일 전송 시간`이라는 공식으로 구할 수 있다.