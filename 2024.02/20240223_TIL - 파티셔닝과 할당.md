# 20240223_TIL - 파티셔닝과 할당

## 파티셔닝과 포매팅

`파일 시스템`은 파일과 디렉터리를 체계적으로 저장하고 접근하게 하는 운영체제 내부 프로그램이다. 파일 시스템에는 다양한 종류가 있고 하나의 컴퓨터에서 여러 파일 시스템을 사용할 수 있다.

### 파티셔닝

한 번도 사용된 적 없는 새 하드 디스크 또는 SSD는 바로 파일을 생성하거나 저장할 수 없다. 아직 저장장치의 논리적인 구획이 만들어지지 않았기 때문이다. 이 논리적인 구획을 `파티션`, 나누는 과정을 `파티셔닝`이라고 한다.

### 포매팅

흔히 저장장치를 완전히 비우는 것으로 알고 있지만 정확히 `포매팅`은 파일 시스템 방식을 결정하는 것을 의미한다. 파티션 별로 별개의 포매팅 방식을 이용할 수 있다. 따라서 파티셔닝과 같이 일어나는 경우가 많다.

## 파일 할당 방법

운영체제는 파일과 디렉터리를 `블록`단위로 저장한다. 하나의 파일은 여러 개의 블록에 걸쳐 저장된다. 이를 `파일을 보조기억장치에 할당한다`고 표현한다.

파일 할당 방식에는 크게 두 가지가 있다. 

### 연속 할당

이름 그대로 연속적인 블록에 파일을 저장하는 방식이다. 

연속 할당의 경우 파일에 접근하려면 파일의 첫 번째 블록 주소와 파일이 차지하고 있는 블록의 길이만 알고 있으면 된다. 따라서 연속 할당 방식의 파일 시스템에서 디렉터리 엔트리에는 이 두 가지와 파일 이름이 적혀 있다.

연속 할당 방식은 구현이 쉽지만, 외부 단편화를 야기한다는 큰 단점이 존재한다. 

### 불연속 할당

크게 두 가지로 나뉜다. `연결 할당`과 `색인 할당`이다.

- `연결 할당(linked allocation)`
    
    각 블록 일부에 다음 블록의 주소를 저장하여, 각 블록이 다음 블록을 가리키는 형태를 가진다. 연결 리스트 자료 구조를 떠올리면 된다. 
    
    파일에 접근하려면 첫 번째 파일의 주소와 마지막으로 참조할 파일 알면 된다. 따라서 연결 할당 방식의 파일 시스템에서는 디렉터리 엔트리에는 첫 번째 파일 주소와 참조할 블록의 갯수 혹은 마지막 파일의 주소가 들어 간다.
    
    이 방식은 외부 단편화 문제는 발생하지 않지만, 파일 내의 임의의 지점에 도달하는 `임의 접근`이 매우 느리다는 단점이 있다. 파일 내 임의의 중간 지점에 도달하려면 반드시 첫 지점이서 시작해서 접근해야 하기 때문이다. 또한, 하드웨어 고장이나 오류가 발생해 링크에 문제가 생기면 그 이후 블록은 접근할 수 없다.
    
    현대의 운영체제는 이런 점을 보완해서 `FAT 파일 시스템`을 만들었다. 이는 나중에 다시 살펴보자.
    
- `색인 할당(indexed allocation)`
    
    파일의 모든 블록 주소를 `색인 블록`이라는 하나의 블록에 모아 관리하는 방식이다. 색인 블록만 알면 해당하는 블록의 데이터에 접근할 수 있다. 따라서 이 방식을 채택하는 파일 시스템에서는 디렉터리 엔트리에 파일 이름과 색인 블록 주소를 명시한다.
    
    현대의 운영체제는 이를 기반으로 `유닉스 파일 시스템`을 사용한다.