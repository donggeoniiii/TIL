# 20240214_TIL - 스래싱과 프레임 할당

## 스래싱과 프레임 할당

사실 근본적으로 페이지 폴트는 프레임을 충분히 많이 할당 받으면 일어날 일이 없다. 페이지 폴트가 일어나는 이유는 기본적으로 프레임이 충분하지 않기 때문이다.

### 스래싱

프레임이 부족해서 프로세스 실행 시간보다 페이징에 더 많은 시간을 쓰는 문제를 `스래싱(thrashing)`이라고 한다. 보통 CPU 사용률이 지나치게 높으면 발생한다. 

참고로 메모리에서 동시에 실행되는 프로세스의 수를 `멀티프로그래밍의 정도`라고 하는데, 이 멀티프로그래밍의 정도가 높으면 메모리에 많은 프로세스가 올라가있다는 뜻이다. 그만큼 CPU의 사용률이 늘어난다. 

그런데 이를 그래프로 표현하다보면, 갑자기 그래프가 팍 꺾이는 시점이 온다. 이때 스래싱이 발생하는 것이다. 너무 많은 프로세스가 프레임을 할당 받다보니 프로세스가 필요로 하는 최소한의 프레임이 충족되지 않았기 때문이다.

### 프레임 할당

운영체제는 이런 일을 막기 위해 프로세스가 모두 작동되게 하기 위해 프로세스 별로 적절한 수의 프레임을 할당해주어야 한다.

- `균등 할당`
    
    먼저 모든 프로세스에 동일한 프레임을 할당한다.
    
- `비례 할당`
    
    프로세스 크기에 비례해서 할당한다.
    

두 가지 모두 프로세스의 실행 과정과 무관한 `정적 할당 방식`에 해당한다.

하지만 이 방식은 말 그대로 프로세스의 실행 과정과 무관하므로 좋은 방식이 아니다. 실제로 실행시켜보면 많은 프레임을 필요로 하는 경우도 있을 것이다. 그래서 `작업 집합 모델`이나 `페이지 폴트 빈도`를 사용한 `동적 할당 방식`이 있다.

- `작업 집합 모델(working set model)`
    
    프로세스가 일정 시간동안 참조한 페이지 모음인 `작업 집합`을 사용한다. CPU는 메모리를 참조할 때 CPU가 과거에 주로 참조한 페이지를 작업 집합에 포함하면 운영체제는 이 작업 집합의 크기를 보고 프레임을 할당한다. 
    
- `페이지 폴트 빈도(Page-Fault Frequency, PFF)`
    
    페이지 폴트 빈도의 상한과 하한을 정해놓고 이를 바탕으로 페이지 폴트 빈도를 바탕으로 프레임을 할당하는 방식이다. 페이지 폴트가 너무 자주 일어난다면 너무 적은 프레임이 할당된 것이므로, 페이지 폴트가 잘 일어나지 않는 프로세스에서 프레임을 회수한다.