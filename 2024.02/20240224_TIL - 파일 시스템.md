# 20240224_TIL - 파일 시스템

불연속 할당의 종류에는 크게 연결 할당과 색인 할당의 두 가지가 있었다. 거기서 연속 할당을 사용해서 `FAT 파일 시스템`이 만들어지고, 색인 할당을 통해 `유닉스 파일 시스템`이 만들어졌다. 각각에 대해 알아보자.

## FAT 파일 시스템

연결 할당의 단점을 보완한 버전의 파일 시스템이다. 

### 연결 할당의 단점과 대안책

연결 할당은 임의 주소 접근이 매우 어렵다는 것과 한 링크가 고장나면 그 이후 주소에는 접근이 불가능하다는 단점이 있었다. 이는 근본적으로 블록 안에 주소를 집어넣기 때문이다.

FAT 파일 시스템은 이를 보완하기 위해 `파일 할당 테이블(File Allocation Table, FAT)`를 사용한다. FAT에는 각 블록의 다음 블록 주소가 모아져 있다. 

이 경우 디렉터리 테이블에는 파일의 이름과 첫 번째 블록 주소만 들어가면 된다. 그렇게 되면 첫 번째 블록의 주소를 타고 들어가서 디렉터리 테이블을 통해 이어진 블록의 주소를 쉽게 확인 가능하다.

### 사용처

주로 usb 메모리나 SD 카드 등의 저용량 저장 장치에 사용된다. 주로 MS-DOS에서 많이 사용되었고, 한 블록을 표현하는 비트 수를 뒤에 붙여서 종류를 나타낸다(FAT12, FAT16, FAT32 등). 

참고로 윈도우에서는 블록이 `클러스터`라고 불린다. FAT 뒤 숫자의 의미는 블록일 때와 같다. 

### 작동 방식

FAT는 파티션의 앞부분에 만들어진다. 때로는 FAT가 캐시메모리에 올라가기도 한다. 이 경우에 기존에 블록을 타고 타고 가는 속도보다 훨씬 빠른 임의주소 접근이 가능하다.

## 유닉스 파일 시스템

색인 할당 기반의 파일 시스템이다. 

### 색인 할당 적용 방식

유닉스 파일 시스템에서는 색인 블록을 `i(index)-node`라고 한다. 여기에는 파일 속성 정보와 열다섯 개의 블록 주소가 저장된다. FAT 방식과 다르게 파일 속성 정보도 디렉터리 엔트리가 아닌 블록에 저장한다는 차이점이 있다.

문제는 열다섯 개의 블록 주소로는 모든 블록 주소를 가리킬 수 없다는 점이다. 이런 문제를 해결하기 위해 유닉스 파일 시스템은 다음과 같은 방식을 사용한다.

### 유닉스 파일 시스템의 블록 주소 지정방식

1. 블록 주소 15칸 중 12칸은 직접 주소 저장
2. 1로 부족하다면 13번째 칸에는 단일 간접 주소 저장
    - 블록 주소들이 저장된 블록 주소를 가리킨다
3. 2로 부족하다면 14번째 칸에는 이중 간접 주소 저장
    - 1에서 사용한 단일 간접 주소 블록들의 주소를 가리킨다
4. 3으로 부족하다면 15번재 칸에는 삼중 간접 주소 저장
    - 내용 동일

4까지 가게 되면 어지간한 양의 파일은 다 표현이 가능하다.