# 20240116_TIL - Recap

## 컴퓨터 구조 개론

### 왜 공부해야 하나?

- 프로그램을 만들 때 성능과 비용을 고려한 설계를 할 수 있다.
- 문제가 발생했을 때 어떤 문제가 발생했는지 알 수 있다.

### 컴퓨터 구조의 큰 그림

- 컴퓨터는 0과 1로 이루어진 명령어와 데이터를 이해한다.
- 컴퓨터가 명령어를 실행하고 전후로 데이터를 읽고 쓰기 위해 중요한 4개의 부품: `CPU`, `메모리`, `보조기억장치`, `주기억장치`
- 위 4개의 부품은 메인보드 위에 올라와 있고, `버스`라는 통로를 통해 데이터와 명령어를 주고 받는다.

## 데이터

### 0과 1로 숫자를 표현하는 방법

- 컴퓨터가 이해하는 건 0과 1뿐이다. 우리가 이해하는 십진법을 컴퓨터에게 이해시키려면 변환이 필요하다.
- 이진법으로 음수를 표현하려면 `2의 보수` 개념을 사용한다. 쉬운 방법은 해당 수의 양수값을 이진법으로 표현하고 그 수에서 1을 빼면 된다.
- 그러나 이진법만 사용하면 데이터를 표현하기에 너무 어렵다. 그래서 이진법의 네자리씩 묶어 십육진법으로도 표현한다.

### 0과 1로 문자를 표현하는 방법

- 컴퓨터가 읽고 표현할 수 있는 문자 모음을 `문자 집합`이라고 한다. 여기에 해당하는 문자의 인코딩을 거치면 컴퓨터가 읽고 쓸 수 있는 0과 1로 변환된다.
- 한글의 인코딩 방식은 초성 중성 종성을 나눠서 표현하는 `조합형 인코딩`과 하나의 단어에 하나의 코드를 대응시키는 `완성형 인코딩` 방식이 있다. 각각의 방식에 해당하는 문자 집합은 유니코드(한글자당 1~4bit)와 EUC-KR(한글자당 2bit)이 있다.

## 명령어

### 소스코드와 명령어

- 컴퓨터가 이해할 수 있는 언어는 `low-level 언어`라고 한다. 기계어와 어셈블리어가 여기 해당한다.
- 사람이 읽을 수 있는 언어를 `high-level 언어`라고 한다. 우리가 아는 프로그래밍 언어들이 여기 해당한다.
- 사람이 프로그래밍한 언어는 컴파일과 인터프리팅 과정을 거쳐서 low-level 언어가 된다.

### 명령어의 구조

- 명령어는 CPU가 실행할 연산방식을 표현하는 `연산코드`와 피연산자를 담는 `오퍼랜드`로 이루어져 있다.
- 오퍼랜드에서는 연산에 사용될 데이터 자체 또는 그 데이터가 있는 주소값이 담겨있다.
- 주소 지정 방식엔 여러 가지가 있다. 직접 데이터를 담고 있는 경우는 `즉시 주소 지정 방식`이라고 하고, 주소를 타고 접근하는 경우에는 `직접 주소 지정 방식`과 `간접 주소 지정 방식`으로 나뉜다.
- 어떤 주소 지정 방식은 특정 레지스터를 이용하기도 한다.

## CPU의 작동 원리

### ALU와 제어장치

- `ALU`는 계산기다. CPU가 명령어를 처리하기 위해 필요한 연산을 처리한다.
- `제어장치`는 명령어를 읽고 쓰기 위해 제어 신호를 CPU 내부와 외부로 보낸다.

### 레지스터

- `프로그램 카운터`: 다음에 실행할 프로세스의 명령어 위치를 저장한다.
- `명령어 레지스터`: 실행할 명령어를 받아놓는다. 제어장치는 여기서 실행할 명령어를 읽어온다.
- `메모리 버퍼 레지스터`: 명령어의 피연산자로 사용할 데이터를 갖고 있다.
- `메모리 주소 레지스터`: 명령어의 피연산자로 사용할 주소를 갖고 있다.
- `플래그 레지스터`: CPU 상태나 연산 결과와 관련된 정보를 갖고 있다.
- `범용 레지스터`: 프리롤을 맡는다.

### 특정 레지스터를 이용한 주소 지정 방식

- `스택 포인터`: 콜스택의 최상단을 가리키고 있다. 실행할 때마다 LIFO 방식으로 실행할 다음 명령어를 가리킨다. 이를 이용한 `스택 주소 지정 방식`이 있다.
- `베이스 레지스터`: 프로세스의 첫번째 명령어의 주소를 갖고 있다. 실행할 명령어의 오퍼랜드 내 값을 비교해 참조할 메모리 주소값을 찾는 `변위 주소 지정 방식`이 있다.

### 명령어 사이클과 인터럽트

- 명령어는 크게 데이터를 불러오는 `인출 싸이클`과 이를 실행시키는 `실행 사이클`이 있다.
    - 간혹 간접 주소 지정 방식처럼 메모리를 두번 들려야 하는 경우는 첫 번째 접근하는 과정을 `간접 사이클`이라고 표현한다.
- 그 사이에 CPU 외부에서 간섭이 들어오거나 명령어 실행 중 문제가 발생하면 `인터럽트`가 발생하기도 한다. 인터럽트의 종류는 흔히 `예외`라고 하는 동기 인터럽트와 `하드웨어 인터럽트`라고 하는 비동기 인터럽트가 있다.
- CPU는 인터럽트가 발생하면 그전에 하던 작업을 즉시 중단하고 스택에 저장한 후에 `ISR`을 실행시켜 인터럽트를 처리하고 다시 일을 처리한다. 이 과정을 `인터럽트 사이클`이라고 한다.

## CPU 성능 향상 기법

### 빠른 CPU를 위한 설계 기법

- CPU가 동작하는 단위 기준인 `클럭 속도`를 높이면 그만큼 템포가 빨라진다.
- CPU가 명령어를 처리하는데 필요한 부품들을 모아서 `코어`라고 한다. 멀티 코어를 사용하는 CPU가 명령어를 처리하는 속도가 더 빠르다.
- 멀티 쓰레드를 지원하는 CPU일수록 CPU가 명령어를 처리하는 속도가 빠르다.

### 명령어 병렬 처리 기법

- CPU가 명령어를 처리하기 위해서는 데이터를 불러오고, 읽고, 연산하고, 결과를 내보내는 과정을 거치는데, 이 과정은 동시에 일어나지 않고 별개의 작업이다.
- 이를 이용해서 명령어를 각 단계별로 이어서 실행하는 것을 `명령어 파이프라이닝`이라고 한다.
- 파이프라인이 여러 개면 `슈퍼 스칼라`라고 한다. 멀티코어/멀티쓰레드 환경에서 가능하다. 이 경우 공통 자원에 대해 관리를 잘 해야 한다.
- 명령어 중 서로 데이터 의존성이 있는 명령어의 경우, 필요한 결과를 받지 못해 실행에 지연이 생기는 경우가 있다. 이 경우 파이프라인에서 실행 순서를 바꿔 의존성이 없는 명령어부터 실행할 수 있다. 이를 `비순차적 명령어 처리`라고 한다.

### CISC와 RISC

- CPU별로 내부 구조나 처리 방식에 따라 이해할 수 있는 명령어의 종류와 생김새가 다르다. CPU마다 이해할 수 있는 명령어들을 `명령어 집합(ISA)`라고 한다.
- `C(Compact)ISC`의 경우 표현할 수 있는 명령어의 종류가 많고 생김새가 다양하다. 다만 자주 사용하는 명령어는 정해져 있으므로 낭비되는 방식이 많고 규격화가 어렵다.
- `R(Reduced)ISC`의 경우 명령어가 표현할 수 있는 종류가 적다. 대신 규격화가 쉬워 파이프라이닝에 유리하다. 자주 사용되는 방식이다.