# 20240113_TIL - 보조기억장치

## 하드디스크

자기적인(magnetic) 방식으로 데이터 저장. 대용량 저장 장치가 필요하거나 서버실에서 자주 사용하고 볼 수 있다. 자기적인 방식이므로 자성을 잃으면 더이상 저장 장치로 사용할 수 없다.

### 부품 설명

LP같이 생겼고, 실제로 LP처럼 동작한다. 동그란 `플래터`에 데이터를 N극과 S극의 형태로 저장한다. 0과 1의 개념이라고 생각하면 된다. 그리고 플래터 중앙의 `스핀들`이 이 플래터를 회전시키면서 작동하고, 이 스핀들이 돌리는 속도를 분당 회전수로 `RPM(Revolution Per Minute)`이라고 표기한다. 이를 LP의 리더(reader) 역할을 하는 뾰족한 `헤드`가 돌아가는 플래터를 감싸서 양쪽으로 읽는다.

### 하드디스크의 저장 단위

플래터는 `트랙`과 `섹터`라는 단위로 데이터를 저장한다. 플래터를 여러 동심원으로 나눴을 때, 한 바퀴를 트랙이라고 표현한다. 그리고 피자처럼 동심원을 잘랐을 때 해당 트랙에 해당하는 부분을 `섹터`라고 표현한다. 섹터의 크기는 하드디스크에 따라 차이가 있다. 플래터는 여러 겹으로 사용되기도 하는데, 이 때 위 아래로 같은 위치에 있는 트랙들을 모아 `실린더`라고 표현한다.

연속된 정보는 보통 이 실린더에 저장된다. 이렇게 저장하는 이유는 디스크 암을 움직일 필요가 없기 때문이다.

### 데이터에 접근하는 과정

하드디스크가 저장된 데이터에 접근하기까지는 `탐색 시간`, `회전 지연`, `전송 시간`으로 나뉜다.

- `탐색 시간`: 접근하려는 데이터가 저장된 트랙까지 헤드를 이동시키는 시간
- `회전 지연`: 헤드가 있는 곳으로 플래터를 돌리는 시간
- `전송 시간`: 하드디스크와 컴퓨터 사이에 데이터를 전송하는 시간

지금까지 배운 시간 개념을 생각하면 어마어마하게 긴 시간이다. 예를 들어 메모리가 1MB를 순차적으로 읽는 시간은 250,000 ns에 불가하지만, 하드디스크에서 1MB를 순차적으로 읽으려면 30,000,000 ns가 걸린다.

이를 단축시키려면 플래터를 빨리 돌리기 위해 RPM을 올리는 것도 중요하지만, 참조 지역성 원리를 이용해 플래터나 헤드를 조금만 돌려도 찾을 수 있게 저장하는 것도 중요하다. 

참고로 다중 헤드를 가지고 있는 하드 디스크도 있다. 이런 경우에는 헤드를 이동시킬 필요가 없으므로 탐색시간이 0이다. 이런 하드 디스크를 헤드가 고정되어 있다고 해서 `고정 하드 디스크`, 이동해야 하는 디스크를 `이동 하드 디스크`라고 한다.

## 플래시메모리

전기적으로 데이터를 읽고 쓰는 반도체 기반의 저장장치. 우리가 흔하게 사용하는 SD카드, USB, SSD가 이에 해당한다. 사실 보조기억장치라는 범주에만 속한다고 보기는 어렵다. 주기억장치나 우리가 사용하는 거의 모든 전자제품 안에서도 사용되기 때문이다. 하드디스크와 마찬가지로 언젠가는 저장 기능을 상실한다.

NAND 연산을 수행하는 회로와 NOR 연산을 수행하는 회로를 기반으로 하는 플래시 메모리로 나뉘고, 대용량 저장 장치로 많이 사용되는 플래시 메모리는 `NAND 플래시 메모리`다.

### 저장 단위

플래시 메모리는 `셀(cell)`이라는 단위 기준으로 데이터를 저장한다. 그리고 셀이 몇 비트를 담느냐에 따라 `SLC(1bit)`, `MLC(2bit)`, `TLC(3bit)`로 타입을 나눈다.

- `SLC(Single Level Cell)`: 1bit이므로 한 셀이 2개의 정보를 표현할 수 있다(0 or 1), 수명이 비교적 길고 빠른 입출력이 가능하지만 비싸다. 보통 기업에서 읽고 쓰는 일이 많고 고성능의 장치가 필요할 때 사용한다.
- `MLC(Multiple Level Cell)`: 2bit이므로 한 셀이 4개의 정보를 표현할 수 있다. SLC보다 대용량화에 유리하다.
- `TLC(Triple Level Cell)`: 3bit이므로 한 셀이 8개의 정보를 표현할 수 있다. 수명과 속도가 떨어지지만 대용량화에 아주 유리하다. 보통 우리가 쓰는 플래시 메모리는 MLC와 TLC 방식 중에서 선택한다.

참고로 한 셀이 4bit를 저장하는 `QLC(Quadruple Level Cell)`도 있지만, 위와 비슷한 흐름이므로 생략한다.

이 셀들이 모여서 `페이지`, `블록`, `플레인`, `다이(die)` 로 올라간다. 플래시 메모리에서 데이터의 읽고 쓰기는 이 중 페이지 단위로 이루어진다. 단 삭제는 블록 단위로 이루어진다.

### 페이지의 상태

데이터의 저장 상황에 따라 `Free`, `Valid`, `Invalid`로 나뉜다.

- `Free`: 데이터 저장 x, 새로운 데이터 저장 가능
- `Valid`: 이미 유효한 데이터 저장되어 있음
- `Invalid`: 유효하지 않은 쓰레기값 저장 상태.
    - 플래시 메모리는 덮어쓰기라는 개념이 없기 때문에 생기는 개념이다. 예를 들어 한 값을 수정했다면 이전 값이 저장된 페이지는 더 이상 필요가 없게 된다. 이 경우 이전 페이지는 `Invalid`가 되는 것이다.
    - 그럼 이런 값들은 어떻게 지워질까? 이를 위해 최근 SSD를 비롯한 플래시 메모리는 가비지 컬렉션을 사용한다. 가비지 컬렉션은 Invalid 페이지를 찾으면 해당 블록의 유효한 페이지를 새 블록에 옮기고 해당 블록을 삭제 처리해서 비운다.

## RAID의 정의와 종류

1TB 하드디스크 4개를 사용하는 컴퓨터가 있고 4TB 하드디스크 1개를 사용하는 컴퓨터가 있다. 다른 스펙은 동일하다고 했을 때 두 컴퓨터의 성능은 동일할까? 정답은 전자가 성능과 안전성에서 유리하다. 그 이유에 대해 알아보자.

### RAID란?

데이터의 안전성 또는 높은 성능을 위해 여러 개의 논리적인 보조기억장치를 하나의 논리적인 보조기억장치로 사용하는 기술을 의미한다. 주로 하드디스크와 SSD를 사용하는 기술이다. 

구성 방법을 `레벨`로 RAID 뒤에 숫자로 표현하는데, 대표적으로 RAID 0 ~ 6이 있고 여기서 파성된 RAID 10, 50 등이 있다. 그 중 RAID 2와 3은 잘 사용하지 않는다.

### RAID의 종류

- `RAID 0`: 여러 개의 보조기억장치에 단순히 데이터를 나누어 담는 방식. 줄무니처럼 분산되어 담는다고 해서 나눠 담겨진 데이터를 스트라입(`stripe`)이라고 한다. 하나에 데이터에 대한 병렬적 처리가 가능하다는 것이 장점이다. 다만 저장된 데이터가 나눠지기 때문에 한 보조기억장치가 잘못되면 전체를 읽을 수 없는 안전성 문제가 있다.
- `RAID 1`: RAID 0에서 복사본을 만들어 저장하는 방식. 예를 들어 4개의 보조저장장치를 사용한다고 하면 두 개의 보조저장장치에는 원본을, 나머지 두 개에는 복사본을 저장하는 방식이다. 같은 내용을 두 번 써야 해서 쓰는 데는 RAID 0에 비해 2배의 시간이 걸린다. 다만 사용공간이 절반으로 줄어들어 경제적이진 않다.
- `RAID 4`: `패리티 비트`를 이용해 오류를 검출하고 복구하는 장치를 두는 구성 방식. 위의 예시를 가져오면 세 개의 보조기억장치에서 스트라이핑 방식으로 저장하고 한 개의 보조기억장치가 오류를 검출하는 방식이다. 원래 패리티 비트는 오류 검출만 가능하지만, RAID에선 복원도 가능하다. 단, 저장은 세 곳에 나눠서 하지만 패리티 정보는 한 곳에 저장되므로 병목현상이 발생할 수 있다.
- `RAID 5`: 패리티 정보를 각각의 보조기억장치에 나눠서 저장하는 방식을 말한다.
- `RAID 6`: 서로 다른 두 개의 패리티 정보를 저장한다. 더욱 안정성을 가져가고 싶을 때 채택하는 방식이다. 저장 속도는 RAID 5보다 느리다.
- `RAID 10, 50`: 각각 RAID 1과 0, RAID 5와 0을 혼합한 방식이다. 이렇게 혼합하는 방식을 `Nested RAID`라고 한다.

각 방식마다 장단점이 있으므로 어떤 것에 중점을 두느냐에 따라 최적의 RAID 레벨은 다 다르다.