# 20240110_TIL - CPU 성능 향상 기법

## 빠른 CPU를 위한 설계 기법

CPU 성능을 위해 알아야 할 개념이 3가지 있다. 바로 `클럭`, `멀티코어`, `멀티스레드`다.

### 클럭

전에 배웠던 내용을 잠시 되살려 보자. `클럭`은 컴퓨터 내부 부품들이 동작하는 시간 단위를 말한다. 만약 기준이 되는 클럭의 시간이 빨라진다면? 자연스럽게 컴퓨터 부품들이 돌아가는 시간도 빨라진다. 그래서 클럭 속도는 일반적으로 CPU의 성능을 나타내는데 많이 사용된다.

그런데 CPU를 찾아보게 되면 스펙으로 기본 클럭 속도(Base)와 최대 클럭 속도(Max)로 나뉘어 있다. 이는 고성능을 요구할 때는 CPU가 클럭을 올리고, 아닌 경우에는 낮추는 방식으로 작동하기 때문이다. 즉, 클럭 속도는 일정하지 않다. 

참고로 이 때 최대 클럭 속도를 강제로 높이는 것을 `오버클럭`이라고 한다. 단 이 경우 발열 문제가 발생해 CPU의 성능에 영향을 미칠 수 있다.

### 코어와 멀티코어

위에서 알아본 바와 같이 클럭 속도만 높여서는 한계가 분명히 존재한다. 그럼 다른 방법은 뭐가 있을까?

우리가 지금까지 배운 CPU 내의 제어장치, ALU, 레지스터들은 하나의 `명령어를 실행하는 부품`이라고 정의할 수 있다. 이를 다른 말로 `코어`라고 한다. 그런데 기술이 발전하면서 현대의 CPU는 이 코어가 여러 개 포함할 수 있게 되었다. 

이렇게 한 CPU에 여러 개의 코어가 들어가 있는 형태를 `멀티코어 CPU`, 혹은 `멀티코어 프로세서`라고 한다. 최대 클럭속도가 1.9GHz인 듀얼 코어 CPU와 2.4GHz인 싱글 코어 CPU를 비교하면 전자가 월등하게 성능이 좋다. 

그럼 듀얼 코어인 CPU와 싱글 코어 CPU의 성능 차이는 정확히 2배일까? 그렇지 않다. 사람이 둘이라고 한명이 일하는 일을 나눠서 하면 2배의 속도가 나지 않는 것처럼, 이를 잘 분배해서 일을 효율적으로 처리하는 것이 중요하다. 여기서 `스레드`와 `멀티스레드`가 등장한다.

### 스레드

멀티스레드 개념을 이해하려면 우선 `스레드`에 대해 이해가 선행되어야 한다. 스레드는 CPU에서 사용하는 개념인 `하드웨어적 스레드`와 프로그램에서 사용하는 `소프트웨어적 스레드`가 있다. 

`하드웨어적 스레드`는 하나의 코어가 동시에 처리하는 명령어 단위를 의미한다. 지금까지 배운 CPU는 1코어 1스레드 CPU였던 것이다. 현대의 CPU는 여러 스레드를 지원해 여러 개의 명령어를 동시에 실행할 수 있다. 이렇게 한 코어로 여러 명령어를 실행하는 CPU를 `멀티스레드 CPU` 또는 `멀티스레드 프로세서`라고 한다.

프로그램에서 사용하는 `소프트웨어적 스레드`에서 스레드는 하나의 프로그램에서 독립적으로 실행되는 단위를 뜻한다. 여기서 멀티스레드 환경은 한 프로그램에서 여러 부분이 독립적으로 동시에 실행된다는 것을 의미한다. 그렇기 때문에 각각의 실행 결과가 프로그램에 서로 다른 영향을 미치지 않도록 주의해야 한다.

예를 들어서 워드를 칠 때 입력받은 내용을 화면에 보여주면서 입력 내용을 저장함과 동시에 맞춤법을 검사하는 과정은 동시에 이루어지는 것이 합리적이다. 이 경우 각 기능을 작동시키는 코드를 각각의 스레드로 만들어서 실행할 수 있겠다.

### 멀티스레드

위에서 말한 것처럼 스레드에는 두 가지 의미가 있지만 여기선 소프트웨어적 스레드는 그냥 `스레드`로, CPU에서 사용하는 스레드는 `하드웨어 스레드`라고 하고 후자의 개념에 초점을 맞춘다.

하나의 코어가 여러 명령어를 처리하려면 어떤 과정을 거쳐야 할까? 이는 CPU가 명령어를 실행시키는 과정을 살펴보자. 제어장치가 명령어를 실행시키려면 `프로그램 카운터`나 `명령어 레지스터` 등 필수로 거쳐야 하는 레지스터가 있다. 한 번에 두 개의 명령어를 실행시키려면? 이 필수 레지스터들이 하나씩 더 있으면 된다. 이렇게 명령어를 실행시키기 위한 한 쌍의 필수 레지스터들을 `레지스터 세트`라고 해 보자. 멀티스레드 환경이란 이 `레지스터 세트`가 코어 내에 여러 개 존재하는 것을 의미한다.

한 편, 프로세스의 입장에서는 하나의 스레드를 한 번에 하나의 명령어를 처리하는 CPU로 느껴진다. 그래서 이 하드웨어 스레드를 `논리 프로세서`라고도 한다. 실제로 물리적인 프로세서(CPU)는 아니지만 그렇게 보인다는 의미라고 볼 수 있겠다.